#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BIN="$ROOT/dino-ds-bin"

if [[ ! -x "$BIN" ]]; then
  echo "ERROR: dino-ds-bin not found or not executable at: $BIN" >&2
  exit 1
fi

# Example usage:
# ./dino-ds lane_02 run --limit 1000

if [[ "$#" -lt 2 ]]; then
  echo "usage: dino-ds lane_XX run [--limit N] [--seed N]" >&2
  exit 1
fi

LANE_ID="$1"
CMD="$2"
shift 2

CONFIG_PATH="$(ls "$ROOT/lanes/${LANE_ID}"*/lane_en.yaml 2>/dev/null | head -n1)"
if [[ -z "${CONFIG_PATH}" ]]; then
  CONFIG_PATH="$(ls "$ROOT/lanes/${LANE_ID}"*/lane_en.yaml 2>/dev/null | head -n1)"
fi
if [[ -z "${CONFIG_PATH}" ]]; then
  echo "ERROR: lane config not found for ${LANE_ID}" >&2
  exit 1
fi

exec "$BIN" gate lane --config "$CONFIG_PATH" "$@"
